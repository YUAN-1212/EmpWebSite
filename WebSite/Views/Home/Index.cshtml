
@*<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>*@

<link href="../../Content/Kendo/default-ocean-blue.css" rel="stylesheet" />
<script src="../../Scripts/Kendo/jszip.min.js"></script>
<script src="../../Scripts/Kendo/kendo.all.min.js"></script>

@{
    ViewBag.Title = "DepList";
}

@using (Html.BeginForm(null, null, FormMethod.Post, new { @id = "formQuery", autocomplete = "off" }))
{
    <h2>test</h2>

    <a class="btn btn-primary" id="btnQuery">
        新增
    </a>

    <!-- Kendo版本 grid start -->
    <div id="dvGrid">
    </div>
    <!-- Kendo版本 grid end -->
}

<script type="text/javascript">
    var grid = $("#dvGrid").data("kendoGrid");

    $(document).ready(function () {
        var formName = "#formQuery";

        var grid = $("#dvGrid").data("kendoGrid");

         //建立Kendo DataSource
        var dataSrc = new kendo.data.DataSource({
            transport: {//主要用於dataSource與後臺數據交互的方法定義
                read: {//讀取
                    //以下其實就是$.ajax的參數
                    type: "POST",
                    url: "@Url.Action("Query")",
                    dataType: "json",
                    error: function (result) {
                        alert(result);
                    }
                }, 
                //parameterMap: function (options, operation) { //自定義請求參數，可自定義添加操作條件
                    //if (type !== "read" && options.models) {//DML操作
                    //    var datas = Hap.prepareSubmitParameter(options, type)
                    //    return kendo.stringify(datas);
                    //} else if (type === "read") {//查詢
                    //    return Hap.prepareQueryParameter(viewModel.model.toJSON(), options)
                    //}
                //}
            },
            schema: {
                //取出資料陣列
                data: function (d) { return d.rows; },
                //取出資料總筆數(計算頁數用)
                total: function (d) { return d.total; },
                model: {
                    id: "Index",// 主鍵字段
                    fields: {
                        Account: {
                        },
                        DepName: {
                        },
                        Name: {
                        },
                    }
                }
            },
            pageSize: 10,
            serverPaging: true,//支持分頁功能
            serverSorting: true,//支持排序功能
            serveFiltering: true,//支持查詢功能
            //bath:true,//可批量操作
            pageable: {
                pageSizes: [5, 10, 20, 50],
                refresh: true,
                buttonCount: 5,

            },
        });

        //這是Kendo Widget
        $('#dvGrid').kendoGrid({
            dataSource: dataSrc,//資料來源
            columns: [
                //"Index",
                { field: "Account", title: "帳號" },
                { field: "DepName", title: "所屬部門" },
                { field: "Name", title: "姓名" },
                { command: ["edit", "destroy"], title: "&nbsp;", width: "160px" }
            ],
            sortable: true,
            //pageable: true,
            pageable: {
                pageSize: 10,
                pageSizes: [5, 10, 20, 50],//分頁大小設置
                refresh: true,  //是否顯示刷新按鈕
                buttonCount: 20,     //顯示分頁按鈕數量
                numeric: true,   //是否顯示分頁按鈕
                previousNext: true, //是否顯示翻頁按鈕
                info: true,        //是否顯示分頁信息
            },
            resizable: true,//大小是否可調，默認為false
            //filterable: true,
            toolbar: ["create"],
            editable: {
                mode: "popup", //使用Popup的模式編輯資料
                update: true, // 若設定為True,當按下Update才server資料
            },
            edit: function (e) {
                //編輯事件觸發時，可以隱藏某些欄位
                //https://docs.telerik.com/kendo-ui/api/javascript/ui/grid/events/edit
                if (!e.model.isNew()) {
                    // 編輯模式
                } else {
                    // 新增模式
                }

                var editWindow = e.container.data("kendoWindow");
                // editWindow.unbind("close");
                editWindow.bind("close", onWindowEditClose);
            },
            save: function (e) {
                // 新增事件

                var editWindow = e.container.data("kendoWindow");
                // editWindow.unbind("close");
                editWindow.bind("close", onWindowEditClose);
            }
        });

        $('#btnQuery').click(function () {
            QueryGrid(formName);

            //要求資料來源重新讀取(並指定切至第一頁)
            dataSrc.read({ page: 1, skip: 0 });
        });
    });

    var onWindowEditClose = function (e) {
        if (preventCloseOnSave) {
            e.preventDefault();
            preventCloseOnSave = false;
        }
    };

</script>